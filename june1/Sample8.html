<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <ul id="demo"></ul>
    <form action="">
        <label for="fname">First Name</label>
        <input type="text" name="" id="fname"> <br> <br>
        <label for="lname">Last Name</label>
        <input type="text" name="" id="lname"> <br> <br>
        <button onclick="adduser()" type="button">Add user</button>
        <button onclick="updateUser()" type="button">Update</button>
    </form>
    <script>
        var arrObj =[]
        function adduser(){
            var user ={
                fname: document.getElementById("fname").value,
                lname: document.getElementById("lname").value
            }
            console.log(user)
            postAllUsersToServer(user)
        }
         
         function postAllUsersToServer(user){
             var postData = new XMLHttpRequest();
             postData.onreadystatechange = function(){
                 if(postData.readyState == 4 && postData.status == 201){
                     console.log("data added successfully")
                     getUserDetailsFromServer()
                 }
             }
             postData.open("POST",'http://localhost:3000/users');
             postData.setRequestHeader("content-type",'application/json');
             postData.send(JSON.stringify(user)) // object variable
         }

         function getUserDetailsFromServer(){
             var getData = new XMLHttpRequest();
             getData.onreadystatechange = function(){
                 if(getData.readyState == 4 & getData.status ==200){
                    //local server user variable
                    arrObj = JSON.parse(getData.response)
                    //  displayAllUsers(JSON.parse(getData.response))
                    displayAllUsers(arrObj)
                 }
             }
             getData.open("GET", 'http://localhost:3000/users');
             getData.send()
         }
        
         function displayAllUsers(arrObj){
            arrObj.forEach((user1)=>{
            var myli = document.createElement("li")
            myli.innerHTML = user1.fname +" "+user1.lname + "<button onclick='editUser(" + user1.id + ")'>EDIT</button> <button onclick='deleteUser(" + user1.id+")'>DELETE</button>"
            document.getElementById("demo").appendChild(myli)
         })
       }
       
       var newObj = {}
       function editUser(id){
            newObj = arrObj[id]
           for(a in newObj){
               document.getElementById(a).value = newObj[a]
           }
       }

       function deleteUser(id){
        var getData = new XMLHttpRequest();
             getData.onreadystatechange = function(){
                 if(getData.readyState == 4 & getData.status ==200){
                    console.log("user deleted successfully")
                 }
             }
             getData.open("DELETE", "http://localhost:3000/users/"+ id);
             getData.send()
       }

    </script>
</body>
</html>